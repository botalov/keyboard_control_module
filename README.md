# Модуль управления роботом для клавиатуры
-----------------------------

Клавиатура - самое старое, распространенное и доступное устройство ввода для ПК. :) А по отношению к ручному режиму управления роботом в RCML ещё и очень перспективное: 101 клавиша - 101 бинарная ось.
Однако роботы чаще обладают осями не бинарными, для которых возможно изменение значений как в большую, так и в нижнюю сторону от исходного.

Данный модуль через свой конфигурационный файл позволяет задать:
- какими осями он будет обладать в среде RCML
- какие клавиши к какому значению будут приводить ось в нажатом и отпущенном состоянии.

Благодаря этому можно, в том числе, и задать две клавиши на одну ось.
*Например, закрепить стрелку вверх за увеличением значения оси движения робота в нажатом состоянии, а стрелку вниз, наоборот, за уменьшением значения оси в нажатом состоянии.
И робот соответственно ехал бы вперед или назад, а при отпускании клавиши останавливался (как это сделано у нашего робота [модели "Таракан"] (https://github.com/RobotControlTechnologies/tarakan_robot_module)).*

**Внимание! Оси данного модуля могут быть не постоянными, т.к. задаются через конфигурационный файл. А значит поведение RCML программы использующей этот модуль и скомпилированной с участием этого модуля может быть неопределено при изменении конфигурации данного модуля!**
Т.к. среда RCML проверяет только уникальность самого модуля, а не его файлов.

- все оси, создаваемые модулем - дискретные, однако можно задавать значения осей с неравномерным шагом;
- для выхода из режима управления, инициированного с данным модулем, используется клавиша **_ESCAPE_**;
- вся конфигурация модуля задается в файле **_config.ini_** в папке модуля.

-----------------------------

####Общие правила задания новых осей:
- в секции **_mapped_axis_** задается связь оси и клавиши клавиатуры;
- связь создается указанием наименования оси в качестве ключа и HEX кода клавиши, связываемой с ней, в качестве значения;
- ось создается модулем только при наличии связи; 
- для каждой создаваемой оси должен быть создан раздел с именем, совпадающим с именованием оси. В данном разделе должны быть указаны верхняя и нижняя границы значений оси, в ключах **_upper_value_** и **_lower_value_** соответственно;
- для каждой связи оси и клавиши создается секция описания поведения оси при изменении положения клавиши, с именем по следующему шаблону: **ось_клавиша**
- в секции описания поведения оси должно быть указаны значения оси при нажатой и отпущенной клавише, в ключах **_pressed_value_** и **_unpressed_value_** соответственно.

[HEX коды клавиш клавиатуры в Microsoft Windows](https://msdn.microsoft.com/en-us/library/windows/desktop/dd375731(v=vs.85).aspx) <br>
[Коды клавиш клавиатуры в Linux](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/include/uapi/linux/input.h) 

-----------------------------

####Пример конфигурации модуля. 
- создается ось с именем *go*, именно под ним она будет доступна в RCML;
- на эту ось назначается две клавиши: *стрелка_вверх* и *стрелка_вниз*;
- ось имет диапазон значений от -1 до 1;
- нажатие клавиши *стрелка_вверх* будет изменять значение оси на число 1, отпускание клавиши на число 0;
- нажатие клавиши *стрелка_вниз* будет изменять значение оси на число -1, отпускание клавиши на число 0.

```ini
;Секция для работы в Linux.
[options]
input_path = /dev/input/event2 ;Путь до файла потока ввода.

;Обязательная секция
[mapped_axis]
;название_оси = код_клавиши (в HEX формате)

go = 0x26 ;стрелка_вверх
go = 0x28 ;стрелка_вниз

;Описание оси go, всегда должно иметь оба ключа
[go]
upper_value = 1 ;Верхняя граница значений оси
lower_value = -1 ;Нижняя граница значений оси

;Описание поведения оси go для клавиши *стрелка_вверх* (0x26)
[go_0x26]
pressed_value = 1 ;При нажатии клавиши *стрелка_вверх* значение оси задать равным 1
unpressed_value = 0 ;При отпускании клавиши *стрелка_вверх* значение оси задать равным 0

;Описание поведения оси go для клавиши *стрелка_вниз* (0x28)
[go_0x28]
pressed_value = -1 ;При нажатии клавиши *стрелка_вниз* значение оси задать равным -1
unpressed_value = 0 ;При отпускании клавиши *стрелка_вниз* значение оси задать равным 0
```
Работа в Linux.
- Сначала необходимо определить какой файл потока связан с клавиатурой.
Это можно сделать зайдя в директорию **'/dev/input/'** . И набрав в ней команду **'ls -l by-path/'**.
Команда выдаст список псевдонимов устройств и связанных с ними файлов потока. Нас интересует строчка вида:<br>
*-event-kbd -> eventX.<br>
eventX и есть искомый нами файл, связанный с клавиатурой. Он находится в каталоге /dev/input/
- Перед запуском программы необходимо разрешить чтение из этого файла. 
Для этого достаточно исполнить команду **'chmod o+r eventX'** в каталоге **'/dev/input/'**.
**'chmod o-r eventX'** вернет права доступа в прежнее состояние.
- Теперь можно задать абсолютный путь до файла потока(**'/dev/input/eventX'**), либо до связанного с ним псевдонима('/dev/input/by-path/*-event-kbd') в config.ini.

####Компиляция
Для компиляции модуля потребуется библиотека [SimpleIni](https://github.com/brofield/simpleini)
